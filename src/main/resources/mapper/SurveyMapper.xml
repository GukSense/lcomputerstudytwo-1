<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lcomputerstudy.example.mapper.SurveyMapper">
	<!-- 설문DB등록 -->
	<insert id="saveSurvey" parameterType="Survey">
		INSERT INTO	lc_survey
		(
			s_title,
			s_description,
			s_user,
			s_datetime
		)
		VALUES (
			#{sTitle},
			#{sDescription},
			#{user.username},
			NOW()
		)
		<selectKey resultType="int" keyProperty="sIdx" order="AFTER">
				SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>
	<insert id="saveQuestion" parameterType="Question">
		INSERT INTO	lc_question
		(
			q_title,
			q_type,
			sIdx			
		)
		VALUES (
			#{qTitle},
			#{qType},
			#{sIdx}
		)
		<selectKey resultType="int" keyProperty="qIdx" order="AFTER">
				SELECT LAST_INSERT_ID()
		</selectKey>				 					
	</insert>
	<insert id="saveItem" parameterType="Question">
		INSERT INTO lc_item (
			sIdx,
			qIdx,
			content
		)
		VALUES 
			<foreach collection="items" item="item" index="index" separator=",">
			(
				#{sIdx},
				#{qIdx},
				#{item.content}
			)
			</foreach>
	</insert>
	<!-- 설문 리스트 -->
	<select id="selectSurvey" resultType="Survey">
		SELECT			s_idx as sIdx,
						s_title as sTitle,
						s_description as sDescription,
						s_user as sName,
						s_datetime as sDateTime
		FROM			lc_survey
		ORDER BY		sDescription
	</select>
 	<select id="getSurvey" resultType="Survey">
		SELECT	s_idx as sIdx,
				s_title as sTitle,
				s_description as sDescription,
				s_user as sName,
				s_datetime as sDateTime
		FROM	lc_survey
		WHERE	s_idx = #{sIdx}
	</select>
	<select id="getQuestions" resultType="Question">
		SELECT	q_idx as qIdx,
				sIdx as sIdx,
				q_title as qTitle,
				q_type as  qType
		FROM	lc_question
		WHERE	sIdx = #{sIdx}
	</select>
	<select id="getItems" resultType="Item">
		SELECT	content as content,
				i_idx as idx			
		FROM	lc_item
		WHERE	sIdx = ${sIdx}
	</select>	
</mapper>